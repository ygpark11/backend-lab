# Stage 1: Build (Node.js í™˜ê²½)
FROM node:22-alpine AS builder

WORKDIR /app

# íŒ¨í‚¤ì§€ ì •ë³´ ë³µì‚¬ ë° ì„¤ì¹˜
COPY package.json package-lock.json ./
RUN npm install

# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬ ë° ë¹Œë“œ
COPY . .
RUN npm run build

# Stage 2: Serve (Nginx í™˜ê²½)
FROM nginx:alpine

# ğŸ”¥ [ì¶”ê°€] 1. íƒ€ì„ì¡´ ë°ì´í„° ì„¤ì¹˜ (Alpineì€ ì´ê²Œ ì—†ìœ¼ë©´ ì‹œê°„ì´ ì•ˆ ë°”ë€œ)
RUN apk add --no-cache tzdata

# ğŸ”¥ [ì¶”ê°€] 2. í•œêµ­ ì‹œê°„ í™˜ê²½ë³€ìˆ˜ ì„¤ì •
ENV TZ=Asia/Seoul

# Nginx ì„¤ì • íŒŒì¼ ë®ì–´ì“°ê¸°
COPY nginx.conf /etc/nginx/conf.d/default.conf

# ë¹Œë“œëœ ê²°ê³¼ë¬¼(dist)ì„ Nginx ì›¹ ë£¨íŠ¸ë¡œ ë³µì‚¬
COPY --from=builder /app/dist /usr/share/nginx/html

# 80ë²ˆ í¬íŠ¸ ì˜¤í”ˆ
EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]